---
title: "202-pairwise-Fst"
output: html_document
date: "2023-08-26"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
```

```{r}
library(tidyverse)
```

Calculating pairwise Fst with ANGSD

_1_ SFS need things organized like so

poplist

bamlist for each pop

meta   

```{r}
m2<-read_csv("meta/58.csv")
m2$Region<-factor(m2$Region, levels=c("Northern Territory","Queensland","Papua New Guinea",
                                              "Indonesia","Philippines","Vietnam","Cambodia","Thailand",
                                              "India Eastern Coast","India Western Coast"))

m3<-filter(m2,Region != "Vietnam") 
m3 %>% group_by(Region) %>% summarize(Count=n())
```


```{r}
Region<-m3 %>% select(Region)
Region$Region<-gsub(" ","", Region$Region)
write_tsv(Region %>% unique(), file="poplists/poplist.txt", col_names = FALSE)

pops<-unique(Region$Region)
m3$pop<-gsub(" ","", m3$Region)
```

```{r}
writeBamlist<-function(Pop, Meta) {
  write_tsv(Meta %>% filter(pop==Pop) %>% select(Path), col_names = FALSE, file=paste0("poplists/",Pop,".bamlist"))
  
}
```

```{r}
lapply(pops,writeBamlist, m3)
```

then sbatch 202.1-calc-sfs.sh

Then to calc pairwise fst, need pairwise list.

poplists/pairwise-list.txt is made

See what we need:     

```{r}
list<-read_tsv("outputs/202/pairwise-list.txt", col_names=c("Pop1","Pop2"))
fst<-read_tsv("outputs/202/pwfst.all", col_names=c("Pop1","Pop2","Unweighted","Weighted"))

fsts<-list %>% left_join(fst)
```

Indonesia.sfs is empty

realSFS Indonesia.saf.idx > Indonesia.sfs

(base) maccamp@farm:~/lates-wgs/outputs/202$ srun -p bigmemh --nodes=1 --mem=96G  --time=12:00:00 realSFS Indonesia.saf.idx > Indonesia.sfs
